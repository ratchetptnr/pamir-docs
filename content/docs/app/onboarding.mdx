---
title: Onboarding
description: Device setup and login flows
---

import { Callout } from 'fumadocs-ui/components/callout'
import { Mermaid } from '@/components/mermaid'

<Callout title="Product Philosophy">
  **Setup must be straightforward.** Users should connect their Distiller in under 2 minutes with clear guidance at every step. Every error state provides a clear path forward.
</Callout>

The onboarding flow handles device discovery via Bluetooth, security setup, and WiFi configuration. It is designed to be a single, cohesive experience.

<Mermaid chart={`
flowchart TD
    Start([User opens App]) --> Welcome[Welcome Screen]
    Welcome -->|Tap Setup| BLESearch[App searching for Distiller]

    BLESearch --> BLEScan{Device found in 15s?}
    BLEScan -->|No| BLERetry[Auto-retry scan]
    BLERetry --> BLEScan2{Device found?}
    BLEScan2 -->|No| BLETroubleshoot[Show troubleshooting]
    BLETroubleshoot --> UserAction1{User action}
    UserAction1 -->|Scan Again| BLESearch
    UserAction1 -->|Give up| EndFail([Setup abandoned])

    BLEScan -->|Yes| BLEConnect[BLE connection established]
    BLEScan2 -->|Yes| BLEConnect

    BLEConnect --> AppSecure[App shows Secure device]
    AppSecure --> NamePassword[Name and password entry]
    
    NamePassword --> SubmitCreds[Tap Continue]
    SubmitCreds --> WiFiList[App shows WiFi network list]
    
    WiFiList --> NetworkChoice{User action}
    NetworkChoice -->|Select from list| SelectNetwork[User selects network]
    NetworkChoice -->|Network not listed| ManualSSID[User enters SSID manually]
    ManualSSID --> EnterWiFiPass
    SelectNetwork --> EnterWiFiPass[User enters WiFi password]
    EnterWiFiPass --> SendCredsWifi[App sends credentials]

    SendCredsWifi --> BLEActive{BLE still connected?}
    BLEActive -->|No| BLELost[Connection lost message]
    BLELost --> BLESearch

    BLEActive -->|Yes| WiFiAttempt{WiFi connection result}

    WiFiAttempt -->|Wrong password| WrongPass[Password error]
    WrongPass --> RetryCount{Retry count}
    RetryCount -->|Less than 2| EnterWiFiPass
    RetryCount -->|2 or more| WrongPassHelper[Show helper text]
    WrongPassHelper --> EnterWiFiPass

    WiFiAttempt -->|Timeout| WiFiTimeout[Timeout error]
    WiFiTimeout --> TimeoutOptions{User choice}
    TimeoutOptions -->|Try Again| SendCredsWifi
    TimeoutOptions -->|Different Network| WiFiList

    WiFiAttempt -->|Success| WiFiSuccess[WiFi connected]

    WiFiSuccess --> SetupComplete[Setup complete]

    SetupComplete --> End([User enters main app])

    style Start fill:#e1f5e1
    style End fill:#e1f5e1
    style EndFail fill:#ffcdd2
    style Welcome fill:#fff4e6
    style SetupComplete fill:#d4edff
    style BLETroubleshoot fill:#ffebee
    style WrongPass fill:#ffebee
    style WiFiTimeout fill:#ffebee
    style BLELost fill:#ffebee
    style ManualSSID fill:#e3f2fd
`} />

---

## BLE Pairing

<Callout title="OS-Level Pairing" type="info">
  BLE pairing (if required) is handled **entirely by iOS/Android at the OS level**. The app cannot customize the pairing dialog. The mobile OS will automatically present the appropriate UI based on the peripheral's advertised I/O capabilities.
</Callout>

The pairing method is determined by the Distiller's firmware configuration and negotiated with the mobile device during connection. Common methods include:

| Method | When Used | User Experience |
| :--- | :--- | :--- |
| **Just Works** | Device has no display/keyboard | Silent, automaticâ€”no user interaction required |
| **Passkey Entry** | Device displays a 6-digit PIN | OS shows a system dialog; user types the PIN |
| **Numeric Comparison** | Both devices have screens | Both show a number; user confirms they match |

**For Distiller**: If the firmware advertises `NoInputNoOutput` capabilities, pairing is **automatic** (Just Works). The app simply initiates the connection, and the OS handles the rest before proceeding to the Security Setup step.

---

## Happy Path: Screen States

This table shows what the user sees on both the mobile app and the device screen during a successful setup.

| Step | User Action | Mobile App State | Device Display State |
| :--- | :--- | :--- | :--- |
| **1. Welcome** | Taps "Setup Distiller" | **Welcome View**<br/>Greeting & CTA | **Status Hub**<br/>QR code (App Link) |
| **2. Finding** | Waits for BLE | **BLE Search**<br/>Searching... (list populates) | **Provisioning**<br/>"Establishing Link..." |
| **3. Select Device** | Taps device from list | **BLE Search**<br/>"Connecting..." on selected row | **Provisioning**<br/>"Link Established" |
| **4. Security** | Sets Name/Pass | **Secure Device**<br/>"Name your Distiller" | **Provisioning**<br/>"Securing Device..." |
| **5. WiFi List** | Selects Network | **WiFi Selection**<br/>Scanned networks shown | **Provisioning**<br/>"Scanning WiFi..." |
| **6. Password** | Enters Password | **WiFi Password** | Unchanged |
| **7. Connecting** | Waits for Join | **Connecting**<br/>Sending credentials... | **Provisioning**<br/>"Joining [SSID]..." |
| **8. Success** | Taps "Continue" | **WiFi Connected!**<br/>Success animation | **Online**<br/>Connected to [SSID] |
| **9. Complete** | Taps "Go to App" | **All Set!** | **Ready**<br/>[Name].devices... |

---

---

## Key Recovery Paths

### Bluetooth Off or Denied
**When**: Pre-check after tapping Setup  
**Recovery**: Modal with "Open Settings" to enable Bluetooth  
**Device**: Unchanged

### Device Not Found
**When**: 15-second scan timeout  
**Recovery**: One auto-retry, then show troubleshooting screen  
**User Options**: Scan Again or Give Up

### Hidden Network
**When**: User taps "My network isn't listed"  
**Recovery**: Manual SSID entry screen, then proceed normally

### Connection Lost During Setup
**When**: BLE disconnects while sending credentials  
**Recovery**: Show "Connection lost. Try again"  
**Device**: Returns to pairing mode

### Wrong WiFi Password
**When**: WiFi auth fails  
**Recovery**: Return to password entry with network pre-selected  
**Helper**: After 2 attempts, show "Password is case-sensitive"

### Connection Timeout
**When**: 30-second WiFi timeout or other failure  
**Recovery**: Options menu with Try Again, Different Network, or Need Help

---

## Device Behavior Notes

**App Closed Mid-Setup**: Device behavior is stateless regarding onboarding sessions. App simply reconnects and resumes flow based on device state (e.g. if already secured, skip security step).

**Already Set Up**: If user wants to add another device, flow is identical but adds to existing account.

---

## Design Principles

1.  **Clear Path Forward**: Every error has retry or alternative method
2.  **Security First**: Device must be named and password-protected before WiFi is configured.
3.  **Show Complexity When Needed**: Manual entry appears only when automatic fails
4.  **Respect Time**: Auto-retry shows progress, not just waiting
5.  **Clear Status**: Processing states explain what's happening

