---
title: Onboarding
description: Device setup and login flows
---

import { Callout } from 'fumadocs-ui/components/callout'
import { Mermaid } from '@/components/mermaid'

<Callout title="Product Philosophy">
  **Setup must be straightforward.** Users should connect their Distiller in under 2 minutes with clear guidance at every step. Every error state provides a clear path forward.
</Callout>

The onboarding flow handles device discovery via Bluetooth, WiFi configuration, and security setup. It is designed to be a single, cohesive experience with no redundant steps.

<Mermaid chart={`
flowchart TD
    Start([User unboxes Distiller]) --> PowerOn[User powers on device]
    PowerOn --> DisplayQR[Display: QR code]

    DisplayQR --> AppLaunch[App launches]

    AppLaunch --> CameraCheck{Camera permission granted?}
    CameraCheck -->|No| CameraError[Show camera permission modal]
    CameraError --> CameraChoice{User choice}
    CameraChoice -->|Open Settings| CameraSettings[User grants permission]
    CameraSettings --> CameraCheck
    CameraChoice -->|Manual Entry| ManualDeviceID[Enter Device ID manually]
    ManualDeviceID --> BLECheck

    CameraCheck -->|Yes| ScanQR[User scans QR code]
    ScanQR --> BLECheck{Bluetooth enabled?}
    BLECheck -->|No| BLEError[Show BT permission modal]
    BLEError --> BLESettings[User fixes BT]
    BLESettings --> BLECheck

    BLECheck -->|Yes| BLESearch[App searching for Distiller]

    BLESearch --> BLEScan{Device found in 15s?}
    BLEScan -->|No| BLERetry[Auto-retry scan]
    BLERetry --> BLEScan2{Device found?}
    BLEScan2 -->|No| BLETroubleshoot[Show troubleshooting]
    BLETroubleshoot --> UserAction1{User action}
    UserAction1 -->|Scan Again| BLESearch
    UserAction1 -->|Give up| EndFail([Setup abandoned])

    BLEScan -->|Yes| BLEConnect[BLE connection established]
    BLEScan2 -->|Yes| BLEConnect

    BLEConnect --> WiFiList[App shows WiFi network list]
    WiFiList --> NetworkChoice{User action}
    NetworkChoice -->|Select from list| SelectNetwork[User selects network]
    NetworkChoice -->|Network not listed| ManualSSID[User enters SSID manually]
    ManualSSID --> EnterWiFiPass
    SelectNetwork --> EnterWiFiPass[User enters WiFi password]
    EnterWiFiPass --> SendCreds[App sends credentials]

    SendCreds --> BLEActive{BLE still connected?}
    BLEActive -->|No| BLELost[Connection lost message]
    BLELost --> DisplayQR

    BLEActive -->|Yes| WiFiAttempt{WiFi connection result}

    WiFiAttempt -->|Wrong password| WrongPass[Password error]
    WrongPass --> RetryCount{Retry count}
    RetryCount -->|Less than 2| EnterWiFiPass
    RetryCount -->|2 or more| WrongPassHelper[Show helper text]
    WrongPassHelper --> EnterWiFiPass

    WiFiAttempt -->|Timeout| WiFiTimeout[Timeout error]
    WiFiTimeout --> TimeoutOptions{User choice}
    TimeoutOptions -->|Try Again| SendCreds
    TimeoutOptions -->|Different Network| WiFiList

    WiFiAttempt -->|Success| WiFiSuccess[WiFi connected]

    WiFiSuccess --> AppSecure[App shows Secure device]

    AppSecure --> NamePassword[Name and password entry]
    NamePassword --> SubmitCreds[Tap Continue]

    SubmitCreds --> SetupComplete[Setup complete]

    SetupComplete --> End([User enters main app])

    style Start fill:#e1f5e1
    style End fill:#e1f5e1
    style EndFail fill:#ffcdd2
    style DisplayQR fill:#fff4e6
    style SetupComplete fill:#d4edff
    style BLEError fill:#ffebee
    style BLETroubleshoot fill:#ffebee
    style WrongPass fill:#ffebee
    style WiFiTimeout fill:#ffebee
    style BLELost fill:#ffebee
    style CameraError fill:#ffebee
    style ManualSSID fill:#e3f2fd
    style ManualDeviceID fill:#e3f2fd
`} />

---

## Happy Path: Screen States

This table shows what the user sees on both the mobile app and the device screen during a successful setup.

| Step | User Action | ðŸ“± Mobile App | ðŸ“Ÿ Device (E-ink) |
| :--- | :--- | :--- | :--- |
| **1. Power On** | Powers on device | (Not open yet) | **QR Code**<br/>"Scan to Setup"<br/>ID: A4F2 |
| **2. Permission** | Grants Camera access | **Camera Permission**<br/>"Allow Camera Access" | Unchanged (QR) |
| **3. Scan** | Scans QR code | **QR Scanner**<br/>Camera Viewfinder | Unchanged (QR) |
| **4. Discovery** | Waits (Auto) | **Searching...**<br/>"Looking for Distiller..." | Unchanged (QR) |
| **5. Connected** | Taps Continue | **Device Found**<br/>"Found Distiller-A4F2" | **Connected**<br/>"App Connected"<br/>Waiting for WiFi... |
| **6. Network** | Selects WiFi & enters password | **Select WiFi**<br/>List of networks | Unchanged (Connected) |
| **7. Provisioning** | Waits (Auto) | **Connecting...**<br/>"Connecting Distiller to WiFi..." | **Connecting**<br/>"Connecting to [SSID]..." |
| **8. Success** | Taps Continue | **WiFi Connected!**<br/>Success animation | **Online**<br/>Connected to [SSID]<br/>192.168.1.45 |
| **9. Security** | Sets Name & Password | **Secure Device**<br/>"Name your Distiller" | Unchanged (Online) |
| **10. Complete** | Taps Go to App | **All Set!**<br/>Desktop Link shown | **Ready**<br/>distiller-a4f2.devices...<br/>(QR updates to access link) |

---

---

## Device Discovery

The primary way to connect your mobile app to a new Distiller is by scanning the unique QR code on the device's screen. This initiates the secure Bluetooth handshake.

<div className="flex justify-center my-8">
  <img 
    src="/docs/app/onboarding-qr-scan.png" 
    alt="QR Scanning Sheet" 
    className="w-full max-w-[320px] rounded-2xl border shadow-xl"
  />
</div>

---

---

## Key Recovery Paths

### Camera Access Denied
**When**: Pre-check when app launches  
**Recovery**: Modal with "Open Settings" or "Enter Device ID Manually"  
**Fallback**: Manual entry using 4-character code from device screen

### Bluetooth Off or Denied
**When**: Pre-check after QR scan  
**Recovery**: Modal with "Open Settings" to enable Bluetooth  
**Device**: Unchanged (still showing QR)

### Device Not Found
**When**: 15-second scan timeout  
**Recovery**: One auto-retry, then show troubleshooting screen  
**User Options**: Scan Again or Give Up

### Hidden Network
**When**: User taps "My network isn't listed"  
**Recovery**: Manual SSID entry screen, then proceed normally

### Connection Lost During Setup
**When**: BLE disconnects while sending credentials  
**Recovery**: Show "Connection lost. Scan QR again"  
**Device**: Returns to QR code automatically

### Wrong WiFi Password
**When**: WiFi auth fails  
**Recovery**: Return to password entry with network pre-selected  
**Helper**: After 2 attempts, show "Password is case-sensitive"

### Connection Timeout
**When**: 30-second WiFi timeout or other failure  
**Recovery**: Options menu with Try Again, Different Network, or Need Help

---

## Device Behavior Notes

**App Closed Mid-Setup**: Device immediately returns to QR code. User scans again to start fresh.

**Already Set Up**: After first setup, QR code changes from setup link to access link. Scanning launches the login screen.

---

## Design Principles

1. **Clear Path Forward**: Every error has retry or alternative method
2. **Streamlined Setup**: No redundant naming steps. The device is named once during the security configuration.
3. **Show Complexity When Needed**: Manual entry appears only when automatic fails
4. **Respect Time**: Auto-retry shows progress, not just waiting
5. **Clear Status**: Processing states explain what's happening
6. **Security Required**: PIN protects device; forgot PIN requires factory reset
