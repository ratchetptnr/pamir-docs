---
title: Onboarding
description: Device setup and login flows
---

import { Callout } from 'fumadocs-ui/components/callout'
import { Mermaid } from '@/components/mermaid'

<Callout title="Product Philosophy">
  **Setup must be straightforward.** Users should connect their Distiller in under 2 minutes with clear guidance at every step. Every error state provides a clear path forward.
</Callout>

The onboarding flow handles device discovery via Bluetooth, security setup, and WiFi configuration. It is designed to be a single, cohesive experience.

<Mermaid chart={`
flowchart TD
    Start([User opens App]) --> Welcome[Welcome Screen]
    Welcome -->|Tap Setup| BLESearch[App searching for Distiller]

    BLESearch --> BLEScan{Device found in 15s?}
    BLEScan -->|No| BLERetry[Auto-retry scan]
    BLERetry --> BLEScan2{Device found?}
    BLEScan2 -->|No| BLETroubleshoot[Show troubleshooting]
    BLETroubleshoot --> UserAction1{User action}
    UserAction1 -->|Scan Again| BLESearch
    UserAction1 -->|Give up| EndFail([Setup abandoned])

    BLEScan -->|Yes| BLEConnect[BLE connection established]
    BLEScan2 -->|Yes| BLEConnect

    BLEConnect --> AppSecure[App shows Secure device]
    AppSecure --> NamePassword[Name and password entry]
    
    NamePassword --> SubmitCreds[Tap Continue]
    SubmitCreds --> WiFiList[App shows WiFi network list]
    
    WiFiList --> NetworkChoice{User action}
    NetworkChoice -->|Select from list| SelectNetwork[User selects network]
    NetworkChoice -->|Network not listed| ManualSSID[User enters SSID manually]
    ManualSSID --> EnterWiFiPass
    SelectNetwork --> EnterWiFiPass[User enters WiFi password]
    EnterWiFiPass --> SendCredsWifi[App sends credentials]

    SendCredsWifi --> BLEActive{BLE still connected?}
    BLEActive -->|No| BLELost[Connection lost message]
    BLELost --> BLESearch

    BLEActive -->|Yes| WiFiAttempt{WiFi connection result}

    WiFiAttempt -->|Wrong password| WrongPass[Password error]
    WrongPass --> RetryCount{Retry count}
    RetryCount -->|Less than 2| EnterWiFiPass
    RetryCount -->|2 or more| WrongPassHelper[Show helper text]
    WrongPassHelper --> EnterWiFiPass

    WiFiAttempt -->|Timeout| WiFiTimeout[Timeout error]
    WiFiTimeout --> TimeoutOptions{User choice}
    TimeoutOptions -->|Try Again| SendCredsWifi
    TimeoutOptions -->|Different Network| WiFiList

    WiFiAttempt -->|Success| WiFiSuccess[WiFi connected]

    WiFiSuccess --> SetupComplete[Setup complete]

    SetupComplete --> End([User enters main app])

    style Start fill:#e1f5e1
    style End fill:#e1f5e1
    style EndFail fill:#ffcdd2
    style Welcome fill:#fff4e6
    style SetupComplete fill:#d4edff
    style BLETroubleshoot fill:#ffebee
    style WrongPass fill:#ffebee
    style WiFiTimeout fill:#ffebee
    style BLELost fill:#ffebee
    style ManualSSID fill:#e3f2fd
`} />

---

## BLE Pairing

<Callout title="OS-Level Pairing" type="info">
  BLE pairing (if required) is handled **entirely by iOS/Android at the OS level**. The app cannot customize the pairing dialog. The mobile OS will automatically present the appropriate UI based on the peripheral's advertised I/O capabilities.
</Callout>

The pairing method is determined by the Distiller's firmware configuration and negotiated with the mobile device during connection. Common methods include:

| Method | When Used | User Experience |
| :--- | :--- | :--- |
| **Just Works** | Device has no display/keyboard | Silent, automatic—no user interaction required |
| **Passkey Entry** | Device displays a 6-digit PIN | OS shows a system dialog; user types the PIN |
| **Numeric Comparison** | Both devices have screens | Both show a number; user confirms they match |

**For Distiller**: If the firmware advertises `NoInputNoOutput` capabilities, pairing is **automatic** (Just Works). The app simply initiates the connection, and the OS handles the rest before proceeding to the Security Setup step.

---

## Happy Path: Screen States

This table shows what the user sees on both the mobile app and the device screen during a successful setup.

| Step | User Action | Mobile App State | Device Display State |
| :--- | :--- | :--- | :--- |
| **1. Welcome** | Taps "Setup Distiller" | **Welcome View**<br/>Greeting & CTA | **Status Hub**<br/>QR code (App Link) |
| **2. Finding** | Waits for BLE | **BLE Search**<br/>Searching... (list populates) | **Provisioning**<br/>"Establishing Link..." |
| **3. Select Device** | Taps device from list | **BLE Search**<br/>"Connecting..." on selected row | **Provisioning**<br/>"Link Established" |
| **4. Security** | Sets Name/Pass | **Secure Device**<br/>"Name your Distiller" | **Provisioning**<br/>"Securing Device..." |
| **5. WiFi List** | Selects Network | **WiFi Selection**<br/>Scanned networks shown | **Provisioning**<br/>"Scanning WiFi..." |
| **6. Password** | Enters Password | **WiFi Password** | Unchanged |
| **7. Connecting** | Waits for Join | **Connecting**<br/>Sending credentials... | **Provisioning**<br/>"Joining [SSID]..." |
| **8. Success** | Taps "Continue" | **WiFi Connected!**<br/>Success animation | **Online**<br/>Connected to [SSID] |
| **9. Complete** | Taps "Go to App" | **All Set!** | **Ready**<br/>[Name].devices... |

---

---

## Key Recovery Paths

### Bluetooth Off or Denied
**When**: Pre-check after tapping Setup  
**Recovery**: Modal with "Open Settings" to enable Bluetooth  
**Device**: Unchanged

### Device Not Found
**When**: 15-second scan timeout  
**Recovery**: One auto-retry, then show troubleshooting screen  
**User Options**: Scan Again or Give Up

### Hidden Network
**When**: User taps "My network isn't listed"  
**Recovery**: Manual SSID entry screen, then proceed normally

### Connection Lost During Setup
**When**: BLE disconnects while sending credentials  
**Recovery**: Show "Connection lost. Try again"  
**Device**: Returns to pairing mode

### Wrong WiFi Password
**When**: WiFi auth fails  
**Recovery**: Return to password entry with network pre-selected  
**Helper**: After 2 attempts, show "Password is case-sensitive"

### Connection Timeout
**When**: 30-second WiFi timeout or other failure  
**Recovery**: Options menu with Try Again, Different Network, or Need Help

---

## Device Behavior Notes

**App Closed Mid-Setup**: Device behavior is stateless regarding onboarding sessions. App simply reconnects and resumes flow based on device state (e.g. if already secured, skip security step).

**Already Set Up**: If user wants to add another device, flow is identical but adds to existing account.

---

## Design Principles

1.  **Clear Path Forward**: Every error has retry or alternative method
2.  **Security First**: Device must be named and password-protected before WiFi is configured.
3.  **Show Complexity When Needed**: Manual entry appears only when automatic fails
4.  **Respect Time**: Auto-retry shows progress, not just waiting
5.  **Clear Status**: Processing states explain what's happening

---

## Completion Flows

<Callout title="Product Philosophy">
  **One screen, many contexts.** Whether setting up a first device, adding another, or recovering a disconnected one—users arrive at the same completion screen with context-appropriate messaging.
</Callout>

The app handles three distinct scenarios that all culminate in a device being connected. Rather than building separate completion flows, we use a single adaptive screen that adjusts its content based on how the user arrived.

### Three Paths to Completion

<Mermaid chart={`
flowchart LR
    subgraph Journeys
        First([First-Time Setup])
        Add([Add Device])
        Recovery([Recovery])
    end

    subgraph Completion
        Screen[Unified Completion Screen]
    end

    First --> Screen
    Add --> Screen
    Recovery --> Screen

    style First fill:#d4edff
    style Add fill:#e8f5e9
    style Recovery fill:#fff4e6
    style Screen fill:#f3e5f5
`} />

| Flow Type | When It Happens | User's Starting Point |
| :--- | :--- | :--- |
| **First-Time Setup** | New user, no devices | Welcome screen |
| **Add Device** | Existing user, adding hardware | Device list or settings |
| **Recovery** | Device went offline | Offline alert |

Each journey has different context and emotional state. A first-time user is excited and learning. Someone adding a device is expanding their setup. A user in recovery mode is frustrated and wants to get back to work.

### Adaptive Completion Screen

The completion screen adjusts four elements based on flow type:

<div className="flex justify-center gap-4 my-8">
  <img
    src="/docs/ios/complete-first-time.png"
    alt="First-time setup completion screen"
    className="w-full max-w-[200px] rounded-2xl border shadow-xl"
  />
  <img
    src="/docs/ios/complete-add-device.png"
    alt="Add device completion screen"
    className="w-full max-w-[200px] rounded-2xl border shadow-xl"
  />
  <img
    src="/docs/ios/complete-recovery.png"
    alt="Recovery completion screen"
    className="w-full max-w-[200px] rounded-2xl border shadow-xl"
  />
</div>

#### Content Variations

| Flow Type | Headline | Subtitle |
| :--- | :--- | :--- |
| **First-Time** | "You're All Set!" | "Your Distiller is ready to use" |
| **Add Device** | "Device Added" | "[Device Name] is now connected" |
| **Recovery** | "Back Online" | "[Device Name] is reconnected" |

#### Primary Action

| Flow Type | Button Text | Destination |
| :--- | :--- | :--- |
| **First-Time** | "Get Started" | Main app (project list) |
| **Add Device** | "Done" | Device list |
| **Recovery** | "Continue" | Previous location in app |

The action returns users to the most logical place given their context.

### Desktop URL: Always Visible

<Callout title="Why Show the URL?" type="info">
  Users often forget their device's web address. By displaying it on every completion screen, we ensure they can always find it—even if they didn't write it down during setup.
</Callout>

Every completion screen prominently displays the device's desktop URL:

<div className="flex justify-center my-8">
  <img
    src="/docs/ios/complete-desktop-url.png"
    alt="Completion screen highlighting desktop URL with copy action"
    className="w-full max-w-[320px] rounded-2xl border shadow-xl"
  />
</div>

```
[devicename].distiller.dev
```

This serves multiple purposes:

- **First-time users** learn where to access their device from a computer
- **Add device users** are reminded of the new device's unique address
- **Recovery users** can verify they recovered the right device

The URL is presented with a copy action for easy transfer to other devices or note-taking apps.

### Navigation Behavior

#### Back Button: Hidden

Completion screens are **terminal states**. There's nothing meaningful to go back to:

- First-time setup? The onboarding flow is complete—going back would restart it
- Add device? The device is added—going back would show incomplete state
- Recovery? The device is recovered—going back would show the recovery flow

Hiding the back button prevents confusion and signals "you're done."

#### Sheet Dismissal

When onboarding or recovery runs inside a sheet (modal presentation), dismissing the sheet after completion returns to the main app. The completion screen uses binding-based dismissal to ensure proper cleanup of navigation state.

### Flow Comparison

| Aspect | First-Time | Add Device | Recovery |
| :--- | :--- | :--- | :--- |
| **BLE Scanning** | Yes | Yes | No |
| **Security Setup** | Yes | Yes | No |
| **WiFi Setup** | Yes | Yes | Yes |
| **Desktop URL Shown** | Yes | Yes | Yes |
| **Headline Tone** | Celebratory | Confirmatory | Reassuring |
| **Back Button** | Hidden | Hidden | Hidden |
