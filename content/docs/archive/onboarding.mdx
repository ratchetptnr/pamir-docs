---
title: Onboarding
description: Device setup and login flows
---

import { Callout } from 'fumadocs-ui/components/callout'
import { Mermaid } from '@/components/mermaid'

<Callout title="Product Philosophy">
  **Setup must be straightforward.** Users should connect their Distiller in under 2 minutes with clear guidance at every step. Every error state provides a clear path forward.
</Callout>

The onboarding flow handles authentication, device pairing via QR code or manual code entry, BLE connection, and WiFi configuration.

<Mermaid chart={`
flowchart TD
    Start([User opens App]) --> Welcome[Welcome Screen]
    Welcome -->|Sign in| Auth[Apple / Google Sign-In]

    Auth --> HasDevices{Existing devices?}
    HasDevices -->|Yes| SkipToApp([Skip to main app])
    HasDevices -->|No| Pairing[Device Pairing Screen]

    Pairing --> PairMethod{Pairing method}
    PairMethod -->|Scan QR code| QRScan[In-app QR scan]
    PairMethod -->|Enter code| CodeEntry[4-digit code entry]

    QRScan --> BLEConnect[BLE auto-connect]
    CodeEntry --> BLEConnect

    BLEConnect --> BLEResult{Connected?}
    BLEResult -->|No| BLEFailed[Connection failed]
    BLEFailed --> FailAction{User action}
    FailAction -->|Try Again| BLEConnect
    FailAction -->|Scan different device| Pairing

    BLEResult -->|Yes| WiFiList[App shows WiFi network list]

    WiFiList --> NetworkChoice{User action}
    NetworkChoice -->|Select from list| SelectNetwork[User selects network]
    NetworkChoice -->|Network not listed| ManualSSID[User enters SSID manually]
    ManualSSID --> EnterWiFiPass
    SelectNetwork --> EnterWiFiPass[User enters WiFi password]
    EnterWiFiPass --> SendCredsWifi[App sends credentials]

    SendCredsWifi --> BLEActive{BLE still connected?}
    BLEActive -->|No| BLELost[Connection lost message]
    BLELost --> Pairing

    BLEActive -->|Yes| WiFiAttempt{WiFi connection result}

    WiFiAttempt -->|Wrong password| WrongPass[Password error]
    WrongPass --> RetryCount{Retry count}
    RetryCount -->|Less than 2| EnterWiFiPass
    RetryCount -->|2 or more| WrongPassHelper[Show helper text]
    WrongPassHelper --> EnterWiFiPass

    WiFiAttempt -->|Timeout| WiFiTimeout[Timeout error]
    WiFiTimeout --> TimeoutOptions{User choice}
    TimeoutOptions -->|Try Again| SendCredsWifi
    TimeoutOptions -->|Different Network| WiFiList

    WiFiAttempt -->|Success| WiFiSuccess[WiFi connected]
    WiFiSuccess --> SetupComplete[Setup complete]
    SetupComplete --> End([User enters main app])

    style Start fill:#e1f5e1
    style End fill:#e1f5e1
    style SkipToApp fill:#e1f5e1
    style Welcome fill:#fff4e6
    style SetupComplete fill:#d4edff
    style BLEFailed fill:#ffebee
    style WrongPass fill:#ffebee
    style WiFiTimeout fill:#ffebee
    style BLELost fill:#ffebee
    style ManualSSID fill:#e3f2fd
    style Pairing fill:#e3f2fd
`} />

---

## Device Pairing

<Callout title="QR Code + Manual Code" type="info">
  The Distiller displays both a QR code and a 4-digit alphanumeric code on its screen. The QR code serves double duty: scanned with the phone's Camera app, it opens or installs the Distiller app. Scanned inside the app, it identifies the specific device for BLE pairing. The 4-digit code is a manual fallback.
</Callout>

After signing in, the app presents a pairing screen with two options:

| Method | How It Works | When Used |
| :--- | :--- | :--- |
| **In-app QR scan** | Point phone at device's QR code using the in-app scanner | Primary method — fastest |
| **4-digit code entry** | Type the code shown on the device screen (e.g. `8X29`) | Fallback — QR won't scan, bright lighting, etc. |

Once the device is identified, BLE connection happens automatically in the background. The pairing screen shows an inline connecting state (spinner + "Connecting to Distiller-8X29...") rather than navigating to a separate screen. This keeps the flow feeling lightweight and allows the user to cancel or scan a different device without navigating back.

If connection fails, the user sees an inline error with two options:
- **Try Again** — retry BLE connection to the same device
- **Scan a Different Device** — return to the QR/code entry screen

---

## Happy Path: Screen States

This table shows what the user sees on both the mobile app and the device screen during a successful setup.

The device display is intentionally simple — it shows the QR code and pairing code throughout the entire setup process, only changing once it's online. All the interactive complexity lives in the app.

| Step | User Action | Mobile App State | Device Display State |
| :--- | :--- | :--- | :--- |
| **1. Welcome** | Signs in with Apple/Google | **Welcome View**<br/>Sign-in buttons | QR code + 4-digit code |
| **2. Pair Device** | Scans QR or enters code | **Device Pairing**<br/>QR scanner + code field | QR code + 4-digit code |
| **3. Connecting** | Waits for BLE | **Device Pairing**<br/>"Connecting..." (inline) | QR code + 4-digit code |
| **4. WiFi List** | Selects Network | **WiFi Selection**<br/>Scanned networks shown | QR code + 4-digit code |
| **5. Password** | Enters Password | **WiFi Password** | QR code + 4-digit code |
| **6. Connecting** | Waits for Join | **Connecting**<br/>Sending credentials... | QR code + 4-digit code |
| **7. Success** | Taps "Continue" | **WiFi Connected!**<br/>Success animation | **Online**<br/>QR code + device URL |
| **8. Complete** | Taps "Get Started" | **All Set!** | **Online**<br/>QR code + device URL |

---

## Key Recovery Paths

### Connection Failed (BLE)
**When**: BLE connection to identified device fails
**Recovery**: Inline error on pairing screen with "Try Again" or "Scan a Different Device"

### Bluetooth Off or Denied
**When**: Pre-check after tapping Setup
**Recovery**: Modal with "Open Settings" to enable Bluetooth
**Device**: Unchanged

### Hidden Network
**When**: User taps "Other Network..."
**Recovery**: Manual SSID entry sheet, then proceed normally

### Connection Lost During Setup
**When**: BLE disconnects while sending credentials
**Recovery**: Show "Connection lost. Try again"
**Device**: Returns to pairing mode

### Wrong WiFi Password
**When**: WiFi auth fails
**Recovery**: Return to password entry with network pre-selected
**Helper**: After 2 attempts, show "Password is case-sensitive"

### Connection Timeout
**When**: 30-second WiFi timeout or other failure
**Recovery**: Options menu with Try Again, Different Network, or Need Help

---

## Returning Users

When a user signs in and already has registered devices, the app skips onboarding entirely and goes straight to the main app (ProjectListView). Device management — adding new devices, removing devices, and signing out — is available in **Settings > Account**.

---

## Device Behavior Notes

**App Closed Mid-Setup**: Device behavior is stateless regarding onboarding sessions. App simply reconnects and resumes flow based on device state.

**Already Set Up**: If user wants to add another device, flow is identical but launched from Settings > Account > Add New Device.

---

## Design Principles

1.  **Clear Path Forward**: Every error has retry or alternative method
2.  **Account-Based Security**: Devices are tied to your account — no separate device passwords
3.  **Show Complexity When Needed**: Manual code entry appears alongside QR scanning, not hidden behind a failure
4.  **Respect Time**: Auto-retry shows progress, not just waiting
5.  **Clear Status**: Processing states explain what's happening

---

## Completion Flows

<Callout title="Product Philosophy">
  **Onboarding and recovery have separate completion screens.** First-time setup and add-device share `SetupCompleteView` with the desktop URL. Recovery uses its own lightweight `RecoveryCompleteView` — a simple "Back Online" confirmation that dismisses the sheet.
</Callout>

The onboarding flow handles two completion scenarios. Recovery has its own self-contained completion — see [Recovery Flow](/docs/app/recovery) for details.

### Two Paths to Onboarding Completion

<Mermaid chart={`
flowchart LR
    subgraph Onboarding
        First([First-Time Setup])
        Add([Add Device])
    end

    subgraph Completion
        Screen[SetupCompleteView]
    end

    First --> Screen
    Add --> Screen

    style First fill:#d4edff
    style Add fill:#e8f5e9
    style Screen fill:#f3e5f5
`} />

| Flow Type | When It Happens | User's Starting Point |
| :--- | :--- | :--- |
| **First-Time Setup** | New user, no devices | Welcome screen |
| **Add Device** | Existing user, adding hardware | Settings > Account |

Each journey has different context. A first-time user is excited and learning. Someone adding a device is expanding their setup.

### Adaptive Completion Screen

The completion screen adjusts its content based on flow type:

<div className="flex justify-center gap-4 my-8">
  <img
    src="/docs/ios/complete-first-time.png"
    alt="First-time setup completion screen"
    className="w-full max-w-[200px] rounded-2xl border shadow-xl"
  />
  <img
    src="/docs/ios/complete-add-device.png"
    alt="Add device completion screen"
    className="w-full max-w-[200px] rounded-2xl border shadow-xl"
  />
</div>

#### Content Variations

| Flow Type | Headline | Subtitle |
| :--- | :--- | :--- |
| **First-Time** | "Your Distiller is ready!" | "Access from this app anytime" |
| **Add Device** | "[Device Name] is ready!" | "Access from this app anytime" |

#### Primary Action

| Flow Type | Button Text | Destination |
| :--- | :--- | :--- |
| **First-Time** | "Continue to App" | Main app (project list) |
| **Add Device** | "Done" | Dismiss sheet |

The action returns users to the most logical place given their context.

### Desktop URL: Always Visible

<Callout title="Why Show the URL?" type="info">
  Users often forget their device's web address. By displaying it on every completion screen, we ensure they can always find it — even if they didn't write it down during setup.
</Callout>

Every completion screen prominently displays the device's desktop URL:

<div className="flex justify-center my-8">
  <img
    src="/docs/ios/complete-desktop-url.png"
    alt="Completion screen highlighting desktop URL with copy action"
    className="w-full max-w-[320px] rounded-2xl border shadow-xl"
  />
</div>

```
[devicename].distiller.dev
```

This serves multiple purposes:

- **First-time users** learn where to access their device from a computer
- **Add device users** are reminded of the new device's unique address
- **Recovery users** can verify they recovered the right device

The URL is presented with a copy action for easy transfer to other devices or note-taking apps.

### Navigation Behavior

#### Back Button: Hidden

Completion screens are **terminal states**. There's nothing meaningful to go back to:

- First-time setup? The onboarding flow is complete — going back would restart it
- Add device? The device is added — going back would show incomplete state
- Recovery? The device is recovered — going back would show the recovery flow

Hiding the back button prevents confusion and signals "you're done."

#### Sheet Dismissal

When onboarding or recovery runs inside a sheet (modal presentation), dismissing the sheet after completion returns to the main app. The completion screen uses binding-based dismissal to ensure proper cleanup of navigation state.

### Flow Comparison

| Aspect | First-Time | Add Device |
| :--- | :--- | :--- |
| **Device Pairing (QR/code)** | Yes | Yes |
| **WiFi Setup** | Yes | Yes |
| **Desktop URL Shown** | Yes | Yes |
| **Headline Tone** | Celebratory | Confirmatory |
| **Back Button** | Hidden | Hidden |

<Callout type="info">
  Recovery uses its own completion screen (`RecoveryCompleteView`) with a "Back Online" message and "Done" button. It does not show the desktop URL since the user already knows their device. See [Recovery Flow](/docs/app/recovery) for the full recovery architecture.
</Callout>
